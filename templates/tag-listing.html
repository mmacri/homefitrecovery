<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Posts Tagged with: [TAG_NAME] - Recovery Essentials</title>
    <meta name="description" content="Browse all recovery content tagged with [TAG_NAME] including guides, product reviews, and expert advice.">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="font-sans bg-gray-50">
    <!-- Header will be included here -->
    <div id="header-placeholder"></div>

    <!-- Page Header -->
    <div class="bg-indigo-700 text-white py-16">
        <div class="container mx-auto px-4">
            <h1 class="text-4xl font-bold mb-4">Tag: <span id="tag-name">[TAG_NAME]</span></h1>
            <p class="text-xl opacity-90" id="tag-description">Browse all content related to this topic.</p>
        </div>
    </div>

    <!-- Breadcrumb Navigation -->
    <div class="bg-gray-100 py-2">
        <div class="container mx-auto px-4">
            <nav class="text-sm" aria-label="Breadcrumb">
                <ol class="list-none p-0 inline-flex">
                    <li class="flex items-center">
                        <a href="/" class="text-gray-600 hover:text-indigo-600">Home</a>
                        <svg class="fill-current w-3 h-3 mx-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>
                    </li>
                    <li class="flex items-center">
                        <a href="/blog/index.html" class="text-gray-600 hover:text-indigo-600">Blog</a>
                        <svg class="fill-current w-3 h-3 mx-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>
                    </li>
                    <li class="flex items-center">
                        <a href="/tags/index.html" class="text-gray-600 hover:text-indigo-600">Tags</a>
                        <svg class="fill-current w-3 h-3 mx-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>
                    </li>
                    <li class="text-indigo-600" id="breadcrumb-tag-name">[TAG_NAME]</li>
                </ol>
            </nav>
        </div>
    </div>

    <!-- Filter Controls -->
    <div class="container mx-auto px-4 py-8">
        <div class="flex flex-wrap items-center justify-between gap-4">
            <div class="flex items-center space-x-2">
                <label for="posts-sort" class="text-sm font-medium text-gray-700">Sort by:</label>
                <select id="posts-sort" class="rounded-md border-gray-300 py-2 pl-3 pr-10 text-sm focus:border-indigo-500 focus:outline-none focus:ring-indigo-500">
                    <option value="date-desc">Newest First</option>
                    <option value="date-asc">Oldest First</option>
                    <option value="title-asc">Title (A-Z)</option>
                    <option value="title-desc">Title (Z-A)</option>
                </select>
            </div>
            <div class="relative">
                <input type="text" id="post-search" placeholder="Search in these posts..." class="w-full rounded-md border-gray-300 py-2 pl-10 pr-4 text-sm focus:border-indigo-500 focus:outline-none focus:ring-indigo-500">
                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                    <i class="fas fa-search text-gray-400"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Posts Grid -->
    <div class="container mx-auto px-4 pb-16">
        <div id="tag-posts-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Posts will be dynamically added here -->
            <div class="animate-pulse">
                <div class="bg-white rounded-lg shadow-md overflow-hidden h-96">
                    <div class="bg-gray-300 h-48"></div>
                    <div class="p-6 space-y-4">
                        <div class="h-6 bg-gray-300 rounded w-3/4"></div>
                        <div class="h-4 bg-gray-300 rounded"></div>
                        <div class="h-4 bg-gray-300 rounded w-5/6"></div>
                        <div class="h-10 bg-gray-300 rounded mt-4 w-1/3"></div>
                    </div>
                </div>
            </div>
            <div class="animate-pulse">
                <div class="bg-white rounded-lg shadow-md overflow-hidden h-96">
                    <div class="bg-gray-300 h-48"></div>
                    <div class="p-6 space-y-4">
                        <div class="h-6 bg-gray-300 rounded w-3/4"></div>
                        <div class="h-4 bg-gray-300 rounded"></div>
                        <div class="h-4 bg-gray-300 rounded w-5/6"></div>
                        <div class="h-10 bg-gray-300 rounded mt-4 w-1/3"></div>
                    </div>
                </div>
            </div>
            <div class="animate-pulse">
                <div class="bg-white rounded-lg shadow-md overflow-hidden h-96">
                    <div class="bg-gray-300 h-48"></div>
                    <div class="p-6 space-y-4">
                        <div class="h-6 bg-gray-300 rounded w-3/4"></div>
                        <div class="h-4 bg-gray-300 rounded"></div>
                        <div class="h-4 bg-gray-300 rounded w-5/6"></div>
                        <div class="h-10 bg-gray-300 rounded mt-4 w-1/3"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden py-16 text-center">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-indigo-100 text-indigo-500 mb-4">
                <i class="fas fa-tag text-xl"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">No posts found</h3>
            <p class="text-gray-500 max-w-md mx-auto">There are currently no posts tagged with this tag. Try browsing our other tags or categories.</p>
            <div class="mt-6">
                <a href="/blog/index.html" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700">
                    Browse All Posts
                </a>
            </div>
        </div>

        <!-- Pagination -->
        <div id="pagination" class="mt-12 flex justify-center">
            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                <a href="#" id="prev-page" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                    <span class="sr-only">Previous</span>
                    <i class="fas fa-chevron-left"></i>
                </a>
                <!-- Page numbers will be dynamically added here -->
                <span id="pagination-numbers"></span>
                <a href="#" id="next-page" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                    <span class="sr-only">Next</span>
                    <i class="fas fa-chevron-right"></i>
                </a>
            </nav>
        </div>
    </div>

    <!-- Related Tags Section -->
    <div class="bg-gray-100 py-12">
        <div class="container mx-auto px-4">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Related Tags</h2>
            <div id="related-tags" class="flex flex-wrap gap-2">
                <!-- Related tags will be dynamically added here -->
                <div class="animate-pulse">
                    <div class="h-8 w-24 bg-gray-300 rounded-full"></div>
                </div>
                <div class="animate-pulse">
                    <div class="h-8 w-32 bg-gray-300 rounded-full"></div>
                </div>
                <div class="animate-pulse">
                    <div class="h-8 w-20 bg-gray-300 rounded-full"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer will be included here -->
    <div id="footer-placeholder"></div>

    <!-- JavaScript -->
    <script src="/js/common.js"></script>
    <script>
        // Tag-specific JavaScript will be dynamically added here
        document.addEventListener('DOMContentLoaded', function() {
            // Get tag from URL path
            const path = window.location.pathname;
            const tagSlug = path.split('/').filter(segment => segment.length > 0).pop().replace('.html', '');

            if (tagSlug) {
                loadTagData(tagSlug);
            } else {
                showError('Tag not found');
            }

            // Set up event listeners
            document.getElementById('posts-sort').addEventListener('change', updatePostsDisplay);
            document.getElementById('post-search').addEventListener('input', updatePostsDisplay);
        });

        async function loadTagData(tagSlug) {
            try {
                // In a real implementation, this would fetch from a server
                // For demo, we'll access the data from localStorage
                const tagData = await getTagData(tagSlug);

                if (tagData) {
                    displayTagInfo(tagData);
                    loadTagPosts(tagData);
                    loadRelatedTags(tagData);
                } else {
                    showError('Tag not found');
                }
            } catch (error) {
                console.error('Error loading tag data:', error);
                showError('Failed to load tag data');
            }
        }

        function getTagData(tagSlug) {
            // In a real implementation, this would fetch from a server
            // For demo, we'll simulate tag data

            // Convert tag slug to tag name for display (e.g., "foam-rolling" to "Foam Rolling")
            const tagName = tagSlug.split('-').map(word =>
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');

            return {
                slug: tagSlug,
                name: tagName,
                description: `All content related to ${tagName.toLowerCase()} techniques, tips, and products.`,
                count: 5, // Number of posts with this tag
                related: ['recovery', 'massage-guns', 'mobility', 'stretching', 'workout-recovery'] // Related tags
            };
        }

        function displayTagInfo(tagData) {
            // Update tag name and description
            document.title = `Posts Tagged with: ${tagData.name} - Recovery Essentials`;
            document.getElementById('tag-name').textContent = tagData.name;
            document.getElementById('breadcrumb-tag-name').textContent = tagData.name;
            document.getElementById('tag-description').textContent = tagData.description;
        }

        async function loadTagPosts(tagData) {
            try {
                // In a real implementation, this would fetch from a server
                // For demo, we'll access blog posts from localStorage
                const storedPosts = localStorage.getItem('recoveryEssentials_blogPosts');
                let posts = [];

                if (storedPosts) {
                    posts = JSON.parse(storedPosts);

                    // Filter posts by tag
                    posts = posts.filter(post => {
                        // Only show published posts
                        if (post.status !== 'published') return false;

                        // Check if post has this tag
                        if (Array.isArray(post.tags)) {
                            return post.tags.some(tag =>
                                tag.toLowerCase() === tagData.slug.toLowerCase() ||
                                tag.toLowerCase() === tagData.name.toLowerCase()
                            );
                        } else if (typeof post.tags === 'string') {
                            return post.tags.toLowerCase().includes(tagData.slug.toLowerCase()) ||
                                   post.tags.toLowerCase().includes(tagData.name.toLowerCase());
                        }

                        return false;
                    });
                }

                displayPosts(posts);
            } catch (error) {
                console.error('Error loading posts:', error);
                showError('Failed to load posts');
            }
        }

        function displayPosts(posts) {
            const container = document.getElementById('tag-posts-container');
            const emptyState = document.getElementById('empty-state');
            const pagination = document.getElementById('pagination');

            container.innerHTML = '';

            if (posts.length === 0) {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
                pagination.classList.add('hidden');
                return;
            }

            container.classList.remove('hidden');
            emptyState.classList.add('hidden');

            // Sort posts based on selected option
            const sortSelect = document.getElementById('posts-sort');
            const sortOption = sortSelect.value;

            posts = sortPosts(posts, sortOption);

            // Display posts
            posts.forEach(post => {
                const postCard = createPostCard(post);
                container.appendChild(postCard);
            });

            // Update pagination (simplified for demo)
            if (posts.length > 9) {
                pagination.classList.remove('hidden');

                // In a real implementation, we would implement actual pagination
                // For demo, just show a simplified version
                document.getElementById('pagination-numbers').innerHTML = `
                    <a href="#" class="relative inline-flex items-center px-4 py-2 border border-indigo-500 bg-indigo-600 text-sm font-medium text-white">1</a>
                    <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">2</a>
                `;
            } else {
                pagination.classList.add('hidden');
            }
        }

        function createPostCard(post) {
            const article = document.createElement('article');
            article.className = 'bg-white rounded-lg shadow-md overflow-hidden transition-transform duration-300 hover:shadow-lg hover:-translate-y-1';

            const featuredImage = post.featuredImage || 'https://ext.same-assets.com/1001010126/placeholder-image.jpg';

            article.innerHTML = `
                <a href="/blog/${post.slug}.html" class="block">
                    <div class="relative h-48 overflow-hidden">
                        <img src="${featuredImage}" alt="${post.title}" class="w-full h-full object-cover">
                        <div class="absolute bottom-0 left-0 bg-indigo-600 text-white text-xs px-2 py-1">
                            ${formatCategory(post.category)}
                        </div>
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">${post.title}</h3>
                        <p class="text-gray-600 mb-4 line-clamp-2">${post.excerpt}</p>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500">${formatDate(post.date)}</span>
                            <span class="text-indigo-600 hover:text-indigo-800 font-medium">Read more</span>
                        </div>
                    </div>
                </a>
            `;

            return article;
        }

        function formatCategory(category) {
            const categories = {
                'massage-therapy': 'Massage Therapy',
                'recovery-techniques': 'Recovery Techniques',
                'product-guides': 'Product Guides',
                'fitness': 'Fitness',
                'injury-prevention': 'Injury Prevention'
            };

            return categories[category] || category.split('-').map(word =>
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function sortPosts(posts, sortOption) {
            const sortedPosts = [...posts];

            switch (sortOption) {
                case 'date-desc':
                    sortedPosts.sort((a, b) => new Date(b.date) - new Date(a.date));
                    break;
                case 'date-asc':
                    sortedPosts.sort((a, b) => new Date(a.date) - new Date(b.date));
                    break;
                case 'title-asc':
                    sortedPosts.sort((a, b) => a.title.localeCompare(b.title));
                    break;
                case 'title-desc':
                    sortedPosts.sort((a, b) => b.title.localeCompare(a.title));
                    break;
            }

            return sortedPosts;
        }

        function updatePostsDisplay() {
            // Get current tag data
            const tagSlug = window.location.pathname.split('/').filter(segment => segment.length > 0).pop().replace('.html', '');
            const tagData = getTagData(tagSlug);

            // Reload posts with current filters
            loadTagPosts(tagData);
        }

        function loadRelatedTags(tagData) {
            const container = document.getElementById('related-tags');
            container.innerHTML = '';

            if (tagData.related && tagData.related.length > 0) {
                tagData.related.forEach(relatedTagSlug => {
                    // Convert slug to name
                    const relatedTagName = relatedTagSlug.split('-').map(word =>
                        word.charAt(0).toUpperCase() + word.slice(1)
                    ).join(' ');

                    const tagElement = document.createElement('a');
                    tagElement.href = `/tags/${relatedTagSlug}.html`;
                    tagElement.className = 'inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-indigo-100 text-indigo-800 hover:bg-indigo-200 transition';
                    tagElement.innerHTML = `
                        <i class="fas fa-tag mr-1 text-xs"></i>
                        ${relatedTagName}
                    `;

                    container.appendChild(tagElement);
                });
            } else {
                container.innerHTML = '<p class="text-gray-500">No related tags found.</p>';
            }
        }

        function showError(message) {
            document.getElementById('tag-posts-container').innerHTML = `
                <div class="col-span-full py-12 text-center">
                    <div class="bg-red-50 text-red-800 p-4 rounded-md inline-block">
                        <i class="fas fa-exclamation-circle mr-2"></i>
                        ${message}
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
